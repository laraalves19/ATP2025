#Aplicacao para gerir um cinema 
#cinema=[sala]
#sala=[nlugares, vendidos, filme]
#nlugares=Int
#filme=string
#vendidos=[Int]

sala1=[100, [1,5,10,14,20,35,48,99], "O rei leao"]
sala2=[80, [2,6,27,30,47,56,58,59,60], "O clube dos poetas mortos"]
sala3=[150, [3,4,5,6,28,36,45,55,60,98,99,100,125,149,150], "It"]
cinema_atual=[sala1, sala2, sala3]
filmes_lista=["o rei leao", "O clube dos poetas mortos", "It"]

def listar(cinema):
    filmes_lista=[]
    for sala in cinema:
        filme_atual=sala[2]
        if filme_atual not in filmes_lista:
            print(f"{filme_atual}")
            filmes_lista.append(filme_atual)
        if not filmes_lista:
            print("Nenhum filme está em exibição.")
    
               
def disponivel(cinema, filme, lugar):
    lugar_livre=True
    for sala in cinema:
        if sala[2]==filme:
            nlugares=sala[0]
            vendidos=sala[1]
            if lugar<=0 or lugar>nlugares:
                lugar_livre=False
                print("Esse lugar não existe!")
            elif lugar in vendidos:
                lugar_livre=False
                print(f"O lugar {lugar} não está disponível!")
            else:
                print(f"O lugar {lugar} está disponivel!")
        else:
            print("O filme não foi enocntrado.")

def vendebilhete(cinema, filme, lugar):
    novo_cinema=[list(sala) for sala in cinema]
    venda_efetuada=False
    filme_encontrado=False
    for i, sala in enumerate(novo_cinema):
        if sala[2]==filme and not venda_efetuada:
            filme_encontrado=True
            nlugares=sala[0]
            vendidos=sala[1]
            if lugar<=0 or lugar>nlugares:
                print(f"O lugar {lugar} nao esta disponivel nesta sala.")
            elif lugar not in vendidos:
                sala[1].append(lugar)
                venda_efetuada=True
            else:
                print(f"O lugar {lugar} ja esta ocupado.")
    if not filme_encontrado:
        cinema_resultado=cinema
        print("Filme não encontrado.")
    elif venda_efetuada:
        cinema_resultado=novo_cinema
    else:
        cinema_resultado=cinema
    return cinema_resultado


def listardisponibilidades(cinema):
        for sala in cinema:
            filme=sala[2]
            nlugares=sala[0]
            vendidos=sala[1]
            n_vendidos=len(vendidos)
            disponiveis = nlugares-n_vendidos
            print(f"Filme: {filme} | Lugares Disponiveis: {disponiveis}") 


def inserirSala(cinema, nova_sala):
    filme=nova_sala[2]
    if not existeSala(cinema,filme):
        cinema.append(nova_sala)
        print(f"Filme:{filme}  | Lugares:{nova_sala[0]} | Vendidos: {nova_sala[1]}")
    else:
        print(f"O {filme} ja esta em exibicao.")
    return cinema

def existeSala(cinema, filme):
    existe_sala=False
    for sala in cinema:
        if sala[2]==filme:
            existe_sala = True
    return existe_sala

    
def menu():
    print(""" 
    (1) Reset
    (2) Listar Cinema
    (3) Lugar Disponivel
    (4) Vender Bilhete
    (5) Listar Disponibilidades
    (6) Inserir Sala
    (7) Existe Sala
    (0) Sair
    """)
    return

def mostrar_filmes():
    print("""
    Cartaz de Filmes
    - O rei leao
    - O clube dos poetas mortos
    - It""")
    return

cond=True
while cond==True:
    menu()
    acao=input("Escolha um numero de 0 a 7 consoante a açao que pretende realizar, de acordo com o menu: ")

    try:
        opcao= int(acao)
    except ValueError:
        opcao=-1

    if opcao==1:
        sala=[]
        menu()
        print ("A lista de salas esta vazia.")
    elif opcao==2:
        listar(cinema_atual)
    elif opcao==3:
        filme=input("Introduza o nome do filme que deseja ver: ")
        lugar=int(input("Introduza o lugar que deseja: "))
        disponivel(cinema_atual, filme, lugar)
    elif opcao==4:
        filme=input("Introduza o filme que deseja ver: ")
        lugar=int(input("Introduza o lugar que deseja: "))
        cinema_atual=vendebilhete(cinema_atual, filme, lugar)
    elif opcao==5:
        listardisponibilidades(cinema_atual)
    elif opcao==6:
        filme=input("Introduza o nome do filme que quer ver: ")
        lugares=int(input("Quantos lugares tem a sala?: "))
        nova_sala=[lugares, [], filme]
        cinema_atual=inserirSala(cinema_atual, nova_sala)
        inserirSala(cinema_atual, nova_sala)
    elif opcao==7:
        filme=input("Introduza o nome do filme que quer ver: ")
        existeSala(cinema_atual, filme)
    elif opcao==0:
        print("Saiu da aplicaçao do cinema. Obrigada pela visita.")
        cond=False
    else: 
        print("Opçao inválida. Escolha um numero pertencente ao menu.")
